### 被控主机上线
#### 1、通过心跳websocket,每秒获取get_heartbeat_result
```python
# 1、获取主机和网络数据 hosts_sorted, network_data = HeartBeat.list_hostandsession()
# 1.1、主机数据 hosts = Host.list_hosts() 读库HostModel.objects.all()
# 1.2、session数据
# 1.2.1、从msf获取session数据 session_info_dict = RpcClient.call(Method.SessionList, timeout=RPC_FRAMEWORK_API_REQ)
# {'8': {'type': 'meterpreter', 'tunnel_local': '172.16.12.135:1234', 'tunnel_peer': '172.16.12.131:49159', 'comm_channel_session': None, 'via_exploit': 'exploit/multi/handler', 'via_payload': 'payload/windows/x64/meterpreter/reverse_tcp', 'desc': 'Meterpreter', 'info': 'win7-PC\\Administrator @ WIN7-PC', 'workspace': 'false', 'session_host': '172.16.12.131', 'session_port': 49159, 'target_host': '', 'username': 'unknown', 'uuid': 'ck7eniuu', 'exploit_uuid': 'fe0e1230-90a8-013a-88e1-000c29627aa3', 'routes': [], 'arch': 'x64', 'name': 8, 'platform': 'windows', 'advanced_info': {'username': 'win7-PC\\Administrator', 'sysinfo': {'Computer': 'WIN7-PC', 'OS': 'Windows 7 (6.1 Build 7601, Service Pack 1).', 'Architecture': 'x64', 'BuildTuple': None, 'System Language': 'zh_CN', 'Domain': 'WORKGROUP', 'Logged On Users': 1, 'IsAdmin': True, 'Pid': 1056}}, 'load_powershell': False, 'load_python': False, 'last_checkin': 1648623779}}
# 更新被控主机IP地理位置等信息
# 2、遍历session信息,并对比主机数据,多出来的即为新上线的被控主机,存入数据库host_create = Host.create_host(session_host)并返回
# 3、通过心跳websocket返回前端
```
# IP地址数据库文件
```text
STATICFILES/STATIC/ip2region.db
STATICFILES/STATIC/GeoLite2-City.mmdb
STATICFILES/STATIC/GeoLite2-ASN.mmdb
STATICFILES/STATIC/GeoLite2-Country.mmdb
```
